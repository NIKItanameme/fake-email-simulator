<script>
    // Function to fetch and display received emails from the server
    async function fetchAndDisplayEmails() {
      const emailList = document.getElementById('emailList');
      emailList.innerHTML = 'Loading emails...';
  
      try {
        const response = await fetch('/api/emails');
        if (!response.ok) throw new Error('Failed to fetch emails');
        const data = await response.json();
        const emails = data.emails || [];
  
        if (emails.length === 0) {
          emailList.innerHTML = '<p>No received emails yet.</p>';
          return;
        }
  
        emailList.innerHTML = '';
        emails.forEach(email => {
          const emailElement = document.createElement('div');
          emailElement.innerHTML = `
            <p><strong>From:</strong> ${email.sender || email.from}<br>
            <strong>To:</strong> ${email.recipient || email.to}<br>
            <strong>Subject:</strong> ${email.subject}<br>
            <strong>Body:</strong> ${email.message || email.body}</p>
          `;
          emailList.appendChild(emailElement);
        });
      } catch (error) {
        emailList.innerHTML = `<p>Error loading emails: ${error.message}</p>`;
      }
    }
  
    // Call to fetch and display emails when the page loads
    window.onload = fetchAndDisplayEmails;
  
    // Event listener for the email form submission
    document.getElementById('emailForm').addEventListener('submit', async function(e) {
      e.preventDefault();
  
      const from = document.getElementById('from').value;
      const to = document.getElementById('to').value;
      const subject = document.getElementById('subject').value;
      const body = document.getElementById('body').value;
  
      try {
        const response = await fetch('/api/emails', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sender: from, recipient: to, subject, message: body })
        });
  
        if (!response.ok) throw new Error('Failed to send email');
  
        // Clear the form fields
        document.getElementById('from').value = '';
        document.getElementById('to').value = '';
        document.getElementById('subject').value = '';
        document.getElementById('body').value = '';
  
        // Refresh the received emails display
        fetchAndDisplayEmails();
      } catch (error) {
        alert(`Error sending email: ${error.message}`);
      }
    });
  </script>
  